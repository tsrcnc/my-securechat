(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[122],{63:(e,t,s)=>{"use strict";var a=s(7260);s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})},8774:(e,t,s)=>{Promise.resolve().then(s.bind(s,9638))},9638:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>n});var a=s(5155),r=s(2115),l=s(63);function n(){let e=(0,l.useRouter)(),[t,s]=(0,r.useState)(null),[n,i]=(0,r.useState)(!0),[o,d]=(0,r.useState)("subscription"),[c,m]=(0,r.useState)(!1),[x,u]=(0,r.useState)(""),[h,b]=(0,r.useState)(!1),[p,g]=(0,r.useState)(null);(0,r.useEffect)(()=>{j()},[]);let j=async()=>{try{let t=localStorage.getItem("user");if(!t)return void e.push("/login");let a=JSON.parse(t);if(!a.domainId)throw Error("No domain associated with user");let r=a.email.split("@")[1],l=await fetch("".concat("http://localhost:5000","/api/domains/").concat(r));if(l.ok){let e=await l.json();s(e)}}catch(e){console.error("Failed to fetch domain info",e)}finally{i(!1)}},f=async()=>{if(t&&confirm("Are you sure you want to cancel your subscription? You will be downgraded to the Trial plan.")){b(!0);try{let e=await fetch("".concat("http://localhost:5000","/api/domains/").concat(t.id,"/cancel-subscription"),{method:"POST",headers:{"Content-Type":"application/json"}}),s=await e.json();if(e.ok)g({type:"success",text:"Subscription cancelled successfully"}),j();else throw Error(s.message||"Failed to cancel subscription")}catch(e){g({type:"error",text:e.message})}finally{b(!1)}}},N=async()=>{if(t){if(x!==t.domainName)return void g({type:"error",text:"Domain name does not match"});b(!0);try{let s=await fetch("".concat("http://localhost:5000","/api/domains/").concat(t.id),{method:"DELETE",headers:{"Content-Type":"application/json"}}),a=await s.json();if(s.ok)localStorage.clear(),e.push("/");else throw Error(a.message||"Failed to delete organization")}catch(e){g({type:"error",text:e.message}),b(!1)}}};return n?(0,a.jsx)("div",{className:"min-h-screen bg-slate-50 flex items-center justify-center",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-brand-600"})}):t?(0,a.jsx)("div",{className:"min-h-screen bg-slate-50 font-sans",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto py-12 px-4 sm:px-6 lg:px-8",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-heading font-bold text-slate-900",children:"Organization Settings"}),(0,a.jsx)("p",{className:"mt-2 text-slate-500",children:"Manage your domain, subscription, and organization data."})]}),p&&(0,a.jsx)("div",{className:"mb-6 p-4 rounded-xl border ".concat("success"===p.type?"bg-green-50 border-green-200 text-green-700":"bg-red-50 border-red-200 text-red-700"),children:p.text}),(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl shadow-slate-200/50 border border-slate-100 overflow-hidden",children:[(0,a.jsx)("div",{className:"border-b border-slate-100",children:(0,a.jsxs)("nav",{className:"flex -mb-px",children:[(0,a.jsx)("button",{onClick:()=>d("subscription"),className:"py-4 px-8 text-sm font-medium border-b-2 transition-colors ".concat("subscription"===o?"border-brand-600 text-brand-600":"border-transparent text-slate-500 hover:text-slate-700 hover:border-slate-300"),children:"Subscription"}),(0,a.jsx)("button",{onClick:()=>d("danger"),className:"py-4 px-8 text-sm font-medium border-b-2 transition-colors ".concat("danger"===o?"border-red-500 text-red-600":"border-transparent text-slate-500 hover:text-slate-700 hover:border-slate-300"),children:"Danger Zone"})]})}),(0,a.jsxs)("div",{className:"p-8",children:["subscription"===o&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-bold text-slate-900",children:"Current Plan"}),(0,a.jsxs)("div",{className:"mt-4 bg-slate-50 rounded-xl p-6 border border-slate-200",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-slate-500 uppercase tracking-wider",children:"Plan Status"}),(0,a.jsx)("p",{className:"mt-1 text-2xl font-bold text-slate-900",children:t.subscriptionStatus})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-slate-500 uppercase tracking-wider",children:"Max Users"}),(0,a.jsx)("p",{className:"mt-1 text-2xl font-bold text-slate-900",children:t.maxUsers})]})]}),t.subscriptionEndDate&&(0,a.jsx)("div",{className:"mt-4 pt-4 border-t border-slate-200",children:(0,a.jsxs)("p",{className:"text-sm text-slate-500",children:["Ends on: ",new Date(t.subscriptionEndDate).toLocaleDateString()]})})]})]}),"TRIAL"!==t.subscriptionStatus&&(0,a.jsxs)("div",{className:"pt-6 border-t border-slate-100",children:[(0,a.jsx)("button",{onClick:f,disabled:h,className:"text-red-600 hover:text-red-700 font-medium text-sm",children:"Cancel Subscription"}),(0,a.jsx)("p",{className:"mt-1 text-xs text-slate-400",children:"Downgrades to Trial plan immediately."})]})]}),"danger"===o&&(0,a.jsx)("div",{className:"space-y-6",children:(0,a.jsxs)("div",{className:"bg-red-50 border border-red-100 rounded-xl p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-bold text-red-800",children:"Delete Organization"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-red-600",children:"This action is irreversible. It will permanently delete:"}),(0,a.jsxs)("ul",{className:"mt-2 list-disc list-inside text-sm text-red-600 ml-2",children:[(0,a.jsxs)("li",{children:["The domain ",(0,a.jsx)("strong",{children:t.domainName})]}),(0,a.jsx)("li",{children:"All user accounts"}),(0,a.jsx)("li",{children:"All messages and conversations"}),(0,a.jsx)("li",{children:"All subscription data"})]}),c?(0,a.jsxs)("div",{className:"mt-6 bg-white p-4 rounded-lg border border-red-200",children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["Type ",(0,a.jsx)("strong",{children:t.domainName})," to confirm:"]}),(0,a.jsx)("input",{type:"text",value:x,onChange:e=>u(e.target.value),className:"w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",placeholder:t.domainName}),(0,a.jsxs)("div",{className:"mt-4 flex gap-3",children:[(0,a.jsx)("button",{onClick:N,disabled:h||x!==t.domainName,className:"bg-red-600 text-white px-4 py-2 rounded-lg font-bold text-sm hover:bg-red-700 transition disabled:opacity-50 disabled:cursor-not-allowed",children:h?"Deleting...":"Confirm Delete"}),(0,a.jsx)("button",{onClick:()=>{m(!1),u("")},className:"bg-slate-100 text-slate-700 px-4 py-2 rounded-lg font-bold text-sm hover:bg-slate-200 transition",children:"Cancel"})]})]}):(0,a.jsx)("button",{onClick:()=>m(!0),className:"mt-6 bg-red-600 text-white px-4 py-2 rounded-lg font-bold text-sm hover:bg-red-700 transition",children:"Delete Organization"})]})})]})]})]})}):(0,a.jsx)("div",{className:"p-8 text-center text-slate-500",children:"Failed to load organization details."})}}},e=>{e.O(0,[441,255,358],()=>e(e.s=8774)),_N_E=e.O()}]);