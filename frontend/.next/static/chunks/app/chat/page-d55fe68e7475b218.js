(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[457],{5802:(e,r,t)=>{Promise.resolve().then(t.bind(t,6245))},6245:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>l});var a=t(5155),s=t(2115),n=t(63),d=t(9829);function l(){let e=(0,n.useRouter)(),[r,t]=(0,s.useState)(null),[l,o]=(0,s.useState)(null),[i,c]=(0,s.useState)(!1),[x,g]=(0,s.useState)([]),[m,h]=(0,s.useState)(""),b=(0,s.useRef)(null);return((0,s.useEffect)(()=>{var e;null==(e=b.current)||e.scrollIntoView({behavior:"smooth"})},[x]),(0,s.useEffect)(()=>{let r=localStorage.getItem("token");if(!r)return void e.push("/login");let a=localStorage.getItem("user");a&&t(JSON.parse(a));let s=(0,d.io)("http://localhost:5000",{auth:{token:r}});return s.on("connect",()=>{console.log("Connected to socket server"),c(!0)}),s.on("disconnect",()=>{console.log("Disconnected from socket server"),c(!1)}),s.on("message",e=>{g(r=>[...r,{id:Date.now().toString()+Math.random().toString(),text:e.text,sender:e.sender||"Unknown",timestamp:Date.now(),isOwn:e.sender===JSON.parse(localStorage.getItem("user")||"{}").displayName}])}),o(s),()=>{s.disconnect()}},[e]),r)?(0,a.jsxs)("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900 overflow-hidden",children:[(0,a.jsxs)("div",{className:"w-64 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 flex flex-col",children:[(0,a.jsxs)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:[(0,a.jsx)("h1",{className:"text-xl font-bold text-brand-600 dark:text-brand-400",children:"My SecureChat"}),(0,a.jsxs)("div",{className:"flex items-center mt-2",children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full mr-2 ".concat(i?"bg-green-500":"bg-red-500")}),(0,a.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:i?"Connected":"Disconnected"})]})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4",children:[(0,a.jsx)("h2",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider mb-4",children:"Channels"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("button",{className:"w-full text-left px-3 py-2 bg-brand-50 dark:bg-brand-900/20 text-brand-700 dark:text-brand-300 rounded-lg font-medium",children:"# general"}),(0,a.jsx)("button",{className:"w-full text-left px-3 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700/50 rounded-lg transition",children:"# random"})]})]}),(0,a.jsx)("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-brand-100 dark:bg-brand-900 flex items-center justify-center text-brand-600 dark:text-brand-300 font-bold",children:r.displayName.charAt(0).toUpperCase()}),(0,a.jsxs)("div",{className:"ml-3",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:r.displayName}),(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate w-24",children:r.email})]})]}),(0,a.jsx)("button",{onClick:()=>{l&&l.disconnect(),localStorage.removeItem("token"),localStorage.removeItem("refreshToken"),localStorage.removeItem("user"),e.push("/login")},className:"text-gray-400 hover:text-red-500 transition",title:"Logout",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})})})]})})]}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col h-full",children:[(0,a.jsxs)("div",{className:"h-16 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between px-6 shadow-sm z-10",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"text-2xl text-gray-400 mr-2",children:"#"}),(0,a.jsx)("h2",{className:"text-lg font-bold text-gray-800 dark:text-white",children:"general"})]}),r.isDomainAdmin&&(0,a.jsx)("button",{onClick:()=>e.push("/admin/settings"),className:"text-sm bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200 px-4 py-2 rounded-lg transition",children:"Admin Settings"})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 space-y-4 bg-gray-50 dark:bg-gray-900",children:[0===x.length?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 mb-4 opacity-20",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),(0,a.jsx)("p",{children:"No messages yet. Start the conversation!"})]}):x.map(e=>(0,a.jsx)("div",{className:"flex ".concat(e.isOwn?"justify-end":"justify-start"),children:(0,a.jsxs)("div",{className:"max-w-xs md:max-w-md lg:max-w-lg xl:max-w-xl rounded-2xl px-4 py-3 shadow-sm ".concat(e.isOwn?"bg-brand-600 text-white rounded-br-none":"bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200 rounded-bl-none border border-gray-100 dark:border-gray-700"),children:[!e.isOwn&&(0,a.jsx)("p",{className:"text-xs font-bold text-brand-600 dark:text-brand-400 mb-1",children:e.sender}),(0,a.jsx)("p",{className:"text-sm md:text-base leading-relaxed",children:e.text}),(0,a.jsx)("p",{className:"text-[10px] mt-1 text-right ".concat(e.isOwn?"text-brand-100":"text-gray-400"),children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},e.id)),(0,a.jsx)("div",{ref:b})]}),(0,a.jsx)("div",{className:"p-4 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700",children:(0,a.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!m.trim()||!l)return;let t={text:m,sender:null==r?void 0:r.displayName,timestamp:Date.now()};l.emit("message",t),h("")},className:"flex gap-4 max-w-4xl mx-auto",children:[(0,a.jsx)("input",{type:"text",value:m,onChange:e=>h(e.target.value),placeholder:"Type a message...",className:"flex-1 px-4 py-3 bg-gray-100 dark:bg-gray-700 border-0 rounded-xl focus:ring-2 focus:ring-brand-500 focus:bg-white dark:focus:bg-gray-600 transition dark:text-white"}),(0,a.jsxs)("button",{type:"submit",disabled:!m.trim()||!i,className:"bg-brand-600 text-white px-6 py-3 rounded-xl hover:bg-brand-700 transition disabled:opacity-50 disabled:cursor-not-allowed font-semibold shadow-lg shadow-brand-600/20 flex items-center gap-2",children:[(0,a.jsx)("span",{children:"Send"}),(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9-2-9-18-9 18 9-2zm0 0v-8"})})]})]})})]})]}):(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-brand-600"})})}}},e=>{e.O(0,[976,441,255,358],()=>e(e.s=5802)),_N_E=e.O()}]);