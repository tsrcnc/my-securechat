(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[457],{4224:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>u});var a=r(5155),s=r(2115),n=r(63),o=r(9829);function l(e){let{isOpen:t,onClose:r,onAddContact:n}=e,[o,l]=(0,s.useState)(""),[i,d]=(0,s.useState)(""),[c,x]=(0,s.useState)(!1),[h,u]=(0,s.useState)("");if(!t)return null;let m=async e=>{e.preventDefault(),x(!0),u("");try{await n(o,i),l(""),d(""),r()}catch(e){u(e.message||"Failed to add contact")}finally{x(!1)}};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-md",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4 text-gray-900 dark:text-white",children:"Add New Contact"}),(0,a.jsxs)("form",{onSubmit:m,children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Email Address"}),(0,a.jsx)("input",{type:"email",value:o,onChange:e=>l(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-brand-500 dark:bg-gray-700 dark:text-white",placeholder:"user@example.com",required:!0})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Nickname (Optional)"}),(0,a.jsx)("input",{type:"text",value:i,onChange:e=>d(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-brand-500 dark:bg-gray-700 dark:text-white",placeholder:"Enter a nickname"})]}),h&&(0,a.jsx)("p",{className:"text-red-500 text-sm mb-4",children:h}),(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)("button",{type:"button",onClick:r,className:"px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:c,className:"px-4 py-2 bg-brand-600 text-white rounded-lg hover:bg-brand-700 disabled:opacity-50",children:c?"Adding...":"Add Contact"})]})]})]})})}function i(e){let{isOpen:t,onClose:r,contacts:n,onCreateGroup:o}=e,[l,i]=(0,s.useState)(""),[d,c]=(0,s.useState)([]),[x,h]=(0,s.useState)(!1);if(!t)return null;let u=async e=>{if(e.preventDefault(),0!==d.length){h(!0);try{await o(l,d),i(""),c([]),r()}catch(e){console.error(e)}finally{h(!1)}}};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-md",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4 text-gray-900 dark:text-white",children:"Create New Group"}),(0,a.jsxs)("form",{onSubmit:u,children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Group Name"}),(0,a.jsx)("input",{type:"text",value:l,onChange:e=>i(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-brand-500 dark:bg-gray-700 dark:text-white",placeholder:"My Awesome Group",required:!0})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Select Participants"}),(0,a.jsx)("div",{className:"max-h-48 overflow-y-auto border border-gray-200 dark:border-gray-700 rounded-lg",children:n.map(e=>(0,a.jsxs)("div",{onClick:()=>{var t;return t=e.id,void c(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t])},className:"p-2 flex items-center cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 ".concat(d.includes(e.id)?"bg-brand-50 dark:bg-brand-900/20":""),children:[(0,a.jsx)("input",{type:"checkbox",checked:d.includes(e.id),readOnly:!0,className:"mr-3"}),(0,a.jsx)("span",{className:"text-gray-800 dark:text-gray-200",children:e.displayName})]},e.id))})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)("button",{type:"button",onClick:r,className:"px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:x||0===d.length,className:"px-4 py-2 bg-brand-600 text-white rounded-lg hover:bg-brand-700 disabled:opacity-50",children:x?"Creating...":"Create Group"})]})]})]})})}function d(e){var t;let{isOpen:r,onClose:n,user:o,isCurrentUser:l,onUpdateProfile:i,onUpdateDisplayName:d}=e,[c,x]=(0,s.useState)(!1),[h,u]=(0,s.useState)(!1),[m,g]=(0,s.useState)("");if((0,s.useEffect)(()=>{o&&g(o.displayName)},[o]),!r||!o)return null;let p=async e=>{if(e.target.files&&e.target.files[0]&&i){x(!0);try{await i(e.target.files[0])}catch(e){console.error("Failed to upload profile photo",e)}finally{x(!1)}}},b=async()=>{d&&""!==m.trim()&&(await d(m),u(!1))};return(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl w-full max-w-sm overflow-hidden transform transition-all",children:[(0,a.jsx)("div",{className:"relative h-32 bg-gradient-to-r from-blue-500 to-purple-600",children:(0,a.jsx)("button",{onClick:n,className:"absolute top-4 right-4 text-white hover:text-gray-200 bg-black bg-opacity-20 rounded-full p-1",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})}),(0,a.jsxs)("div",{className:"relative px-6 pb-6 pt-16",children:[(0,a.jsx)("div",{className:"absolute -top-16 left-1/2 transform -translate-x-1/2",children:(0,a.jsxs)("div",{className:"relative w-32 h-32 rounded-full border-4 border-white dark:border-gray-800 overflow-hidden bg-gray-200 flex items-center justify-center shadow-lg",children:[o.avatarUrl?(0,a.jsx)("img",{src:o.avatarUrl,alt:o.displayName,className:"w-full h-full object-cover"}):(0,a.jsx)("span",{className:"text-4xl font-bold text-gray-500",children:null==(t=o.displayName)?void 0:t.charAt(0).toUpperCase()}),l&&(0,a.jsxs)("label",{className:"absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-40 flex items-center justify-center cursor-pointer transition-opacity group",children:[(0,a.jsx)("input",{type:"file",className:"hidden",accept:"image/*",onChange:p,disabled:c}),(0,a.jsxs)("svg",{className:"w-8 h-8 text-white opacity-0 group-hover:opacity-100",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]})]})]})}),(0,a.jsxs)("div",{className:"text-center mt-4",children:[l&&h?(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-2 mb-2",children:[(0,a.jsx)("input",{type:"text",value:m,onChange:e=>g(e.target.value),className:"border border-gray-300 dark:border-gray-600 rounded px-2 py-1 text-center bg-transparent dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,a.jsx)("button",{onClick:b,className:"text-green-500 hover:text-green-600",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,a.jsx)("button",{onClick:()=>u(!1),className:"text-red-500 hover:text-red-600",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}):(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:o.displayName}),l&&(0,a.jsx)("button",{onClick:()=>u(!0),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-200",children:(0,a.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})})]}),(0,a.jsx)("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:o.email}),l&&c&&(0,a.jsx)("p",{className:"text-sm text-blue-500 mt-2",children:"Uploading..."})]}),!l&&(0,a.jsx)("div",{className:"mt-8 flex justify-center space-x-4",children:(0,a.jsx)("button",{className:"flex-1 bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition font-medium",children:"Message"})})]})]})})}function c(e){var t;let{currentUser:r,currentChannelId:n,onChannelSelect:o,onConversationSelect:c,onLogout:x,isOpen:h,onClose:u}=e,[m,g]=(0,s.useState)("CHATS"),[p,b]=(0,s.useState)([]),[y,f]=(0,s.useState)([]),[v,k]=(0,s.useState)([]),[j,N]=(0,s.useState)(!1),[w,C]=(0,s.useState)(!1),[S,L]=(0,s.useState)(null),[A,U]=(0,s.useState)(""),M=async()=>{try{let e=localStorage.getItem("token"),t={Authorization:"Bearer ".concat(e)},r=await fetch("".concat("http://localhost:5000","/api/chat/channels"),{headers:t});r.ok&&b(await r.json());let a=await fetch("".concat("http://localhost:5000","/api/contacts"),{headers:t});if(a.ok){let e=await a.json();f(e.map(e=>e.Contact))}let s=await fetch("".concat("http://localhost:5000","/api/chat/conversations"),{headers:t});s.ok&&k(await s.json())}catch(e){console.error("Failed to fetch sidebar data",e)}};(0,s.useEffect)(()=>{M()},[]);let O=async(e,t)=>{let r=localStorage.getItem("token"),a=await fetch("".concat("http://localhost:5000","/api/contacts/add"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)},body:JSON.stringify({email:e,nickname:t})});if(!a.ok)throw Error((await a.json()).error);M()},E=async(e,t)=>{let r=localStorage.getItem("token");if(!(await fetch("".concat("http://localhost:5000","/api/chat/create"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)},body:JSON.stringify({name:e,type:"GROUP",participantId:null})})).ok)throw Error("Failed to create group");M()},I=async e=>{let t=localStorage.getItem("token"),r=await fetch("".concat("http://localhost:5000","/api/chat/create"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({type:"DIRECT",participantId:e})});if(r.ok){let e=await r.json();c(e.id,"DIRECT",e),u()}};return(0,a.jsxs)(a.Fragment,{children:[h&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-20 md:hidden",onClick:u}),(0,a.jsxs)("div",{className:"\n                fixed md:static inset-y-0 left-0 z-30 w-80 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 flex flex-col transform transition-transform duration-200 ease-in-out\n                ".concat(h?"translate-x-0":"-translate-x-full md:translate-x-0","\n            "),children:[(0,a.jsxs)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center cursor-pointer hover:opacity-80",onClick:()=>L(r),children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-brand-600 flex items-center justify-center text-white font-bold mr-2",children:null==r||null==(t=r.displayName)?void 0:t.charAt(0).toUpperCase()}),(0,a.jsx)("span",{className:"font-semibold text-gray-800 dark:text-white truncate max-w-[120px]",children:null==r?void 0:r.displayName})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:x,className:"text-gray-500 hover:text-red-500",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})})}),(0,a.jsx)("button",{onClick:u,className:"md:hidden text-gray-500",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:"text",placeholder:"Search chats or contacts...",value:A,onChange:e=>U(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-brand-500"}),(0,a.jsx)("svg",{className:"w-5 h-5 text-gray-400 absolute left-3 top-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]})]}),(0,a.jsxs)("div",{className:"flex border-b border-gray-200 dark:border-gray-700",children:[(0,a.jsx)("button",{onClick:()=>g("CHATS"),className:"flex-1 py-3 text-sm font-medium ".concat("CHATS"===m?"text-brand-600 border-b-2 border-brand-600":"text-gray-500 hover:text-gray-700 dark:text-gray-400"),children:"Chats"}),(0,a.jsx)("button",{onClick:()=>g("CONTACTS"),className:"flex-1 py-3 text-sm font-medium ".concat("CONTACTS"===m?"text-brand-600 border-b-2 border-brand-600":"text-gray-500 hover:text-gray-700 dark:text-gray-400"),children:"Contacts"}),(0,a.jsx)("button",{onClick:()=>g("GROUPS"),className:"flex-1 py-3 text-sm font-medium ".concat("GROUPS"===m?"text-brand-600 border-b-2 border-brand-600":"text-gray-500 hover:text-gray-700 dark:text-gray-400"),children:"Groups"})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-2",children:["CHATS"===m&&(0,a.jsx)("div",{className:"space-y-1",children:v.filter(e=>{var t;let a=null==(t=e.ConversationParticipant.find(e=>e.User.id!==(null==r?void 0:r.id)))?void 0:t.User,s="GROUP"===e.type?e.name:(null==a?void 0:a.displayName)||"Unknown";return null==s?void 0:s.toLowerCase().includes(A.toLowerCase())}).map(e=>{var t,s;let n=null==(t=e.ConversationParticipant.find(e=>e.User.id!==(null==r?void 0:r.id)))?void 0:t.User,o="GROUP"===e.type?e.name:null==n?void 0:n.displayName;return(0,a.jsxs)("button",{onClick:()=>c(e.id,e.type,e),className:"w-full text-left p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full bg-gray-200 dark:bg-gray-600 flex items-center justify-center text-gray-600 dark:text-gray-300 font-bold mr-3",children:null==o?void 0:o.charAt(0).toUpperCase()}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"font-medium text-gray-900 dark:text-white truncate",children:o}),(0,a.jsx)("p",{className:"text-sm text-gray-500 truncate",children:(null==(s=e.Message[0])?void 0:s.content)||"No messages yet"})]})]},e.id)})}),"CONTACTS"===m&&(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("button",{onClick:()=>N(!0),className:"w-full text-left p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center text-brand-600",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full bg-brand-100 flex items-center justify-center mr-3",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})}),(0,a.jsx)("span",{className:"font-medium",children:"Add New Contact"})]}),y.filter(e=>{var t;return(null==(t=e.nickname||e.displayName)?void 0:t.toLowerCase().includes(A.toLowerCase()))||e.email.toLowerCase().includes(A.toLowerCase())}).map(e=>{var t;return(0,a.jsxs)("button",{onClick:()=>I(e.id),className:"w-full text-left p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full bg-gray-200 dark:bg-gray-600 flex items-center justify-center text-gray-600 dark:text-gray-300 font-bold mr-3 hover:ring-2 hover:ring-brand-500 transition-all",onClick:t=>{t.stopPropagation(),L(e)},children:null==(t=e.nickname||e.displayName)?void 0:t.charAt(0).toUpperCase()}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-gray-900 dark:text-white",children:e.nickname||e.displayName}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:e.email})]})]},e.id)})]}),"GROUPS"===m&&(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("button",{onClick:()=>C(!0),className:"w-full text-left p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center text-brand-600",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full bg-brand-100 flex items-center justify-center mr-3",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})}),(0,a.jsx)("span",{className:"font-medium",children:"Create New Group"})]}),v.filter(e=>{var t;return"GROUP"===e.type&&(null==(t=e.name)?void 0:t.toLowerCase().includes(A.toLowerCase()))}).map(e=>{var t;return(0,a.jsxs)("button",{onClick:()=>c(e.id,"GROUP",e),className:"w-full text-left p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center font-bold mr-3",children:null==(t=e.name)?void 0:t.charAt(0).toUpperCase()}),(0,a.jsx)("p",{className:"font-medium text-gray-900 dark:text-white",children:e.name})]},e.id)})]})]})]}),(0,a.jsx)(l,{isOpen:j,onClose:()=>N(!1),onAddContact:O}),(0,a.jsx)(i,{isOpen:w,onClose:()=>C(!1),contacts:y,onCreateGroup:E}),(0,a.jsx)(d,{isOpen:!!S,onClose:()=>L(null),user:S,isCurrentUser:(null==S?void 0:S.id)===(null==r?void 0:r.id),onUpdateDisplayName:async e=>{console.log("Update display name to:",e)},onUpdateProfile:async e=>{console.log("Upload file:",e)}})]})}function x(e){let{messages:t,currentUser:r}=e,n=(0,s.useRef)(null);return(0,s.useEffect)(()=>{var e;null==(e=n.current)||e.scrollIntoView({behavior:"smooth"})},[t]),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50 dark:bg-gray-900",children:[0===t.length?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 mb-4 opacity-20",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),(0,a.jsx)("p",{children:"No messages yet. Start the conversation!"})]}):t.map(e=>{var t,s;let n=e.senderId===(null==r?void 0:r.id),o=(null==(t=e.User)?void 0:t.displayName)||"Unknown";return(0,a.jsx)("div",{className:"flex ".concat(n?"justify-end":"justify-start"),children:(0,a.jsxs)("div",{className:"max-w-[85%] md:max-w-md lg:max-w-lg xl:max-w-xl rounded-2xl px-4 py-3 shadow-sm ".concat(n?"bg-brand-600 text-white rounded-br-none":"bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200 rounded-bl-none border border-gray-100 dark:border-gray-700"),children:[!n&&(0,a.jsx)("p",{className:"text-xs font-bold text-brand-600 dark:text-brand-400 mb-1",children:o}),(0,a.jsx)("p",{className:"text-sm md:text-base leading-relaxed break-words",children:e.content}),(0,a.jsxs)("div",{className:"flex items-center justify-end space-x-1 mt-1",children:[(0,a.jsx)("p",{className:"text-[10px] ".concat(n?"text-brand-100":"text-gray-400"),children:new Date(e.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),n&&((s=e.status)&&"SENT"!==s?"DELIVERED"===s?(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("svg",{className:"w-3 h-3 text-brand-200",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),(0,a.jsx)("svg",{className:"w-3 h-3 text-brand-200 -ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})]}):"READ"===s?(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("svg",{className:"w-3 h-3 text-blue-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),(0,a.jsx)("svg",{className:"w-3 h-3 text-blue-300 -ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})]}):null:(0,a.jsx)("svg",{className:"w-3 h-3 text-brand-200",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}))]})]})},e.id)}),(0,a.jsx)("div",{ref:n})]})}function h(e){let{onSendMessage:t,disabled:r}=e,[n,o]=(0,s.useState)("");return(0,a.jsx)("div",{className:"p-4 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700",children:(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),n.trim()&&!r&&(t(n),o(""))},className:"flex gap-4 max-w-4xl mx-auto",children:[(0,a.jsx)("input",{type:"text",value:n,onChange:e=>o(e.target.value),placeholder:"Type a message...",className:"flex-1 px-4 py-3 bg-gray-100 dark:bg-gray-700 border-0 rounded-xl focus:ring-2 focus:ring-brand-500 focus:bg-white dark:focus:bg-gray-600 transition dark:text-white",disabled:r}),(0,a.jsxs)("button",{type:"submit",disabled:!n.trim()||r,className:"bg-brand-600 text-white px-6 py-3 rounded-xl hover:bg-brand-700 transition disabled:opacity-50 disabled:cursor-not-allowed font-semibold shadow-lg shadow-brand-600/20 flex items-center gap-2",children:[(0,a.jsx)("span",{className:"hidden sm:inline",children:"Send"}),(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9-2-9-18-9 18 9-2zm0 0v-8"})})]})]})})}function u(){let e=(0,n.useRouter)(),[t,r]=(0,s.useState)(null),[l,i]=(0,s.useState)(null),[u,m]=(0,s.useState)(!1),[g,p]=(0,s.useState)(""),[b,y]=(0,s.useState)(""),[f,v]=(0,s.useState)(""),[k,j]=(0,s.useState)(null),[N,w]=(0,s.useState)([]),[C,S]=(0,s.useState)(!1),[L,A]=(0,s.useState)(!1),[U,M]=(0,s.useState)(null);(0,s.useEffect)(()=>{if(!localStorage.getItem("token"))return void e.push("/login");let t=localStorage.getItem("user");t&&r(JSON.parse(t))},[e]),(0,s.useEffect)(()=>{if(!t)return;let e=localStorage.getItem("token"),r=(0,o.io)("http://localhost:5000",{auth:{token:e}});return r.on("connect",()=>{console.log("Connected to socket server"),m(!0)}),r.on("disconnect",()=>{console.log("Disconnected from socket server"),m(!1)}),r.on("receive_message",e=>{w(t=>{let r="CHANNEL"===b&&e.channelId===g,a=("DIRECT"===b||"GROUP"===b)&&e.conversationId===g;return r||a?[...t,e]:t})}),i(r),()=>{r.disconnect()}},[t,g,b]);let O=(0,s.useRef)(g),E=(0,s.useRef)(b);(0,s.useEffect)(()=>{O.current=g,E.current=b},[g,b]),(0,s.useEffect)(()=>{l&&g&&("CHANNEL"===b?l.emit("join_channel",g):l.emit("join_conversation",g),I(g))},[g,b,l]);let I=async e=>{try{let t=localStorage.getItem("token"),r=await fetch("".concat("http://localhost:5000","/api/chat/history/").concat(e),{headers:{Authorization:"Bearer ".concat(t)}});if(r.ok){let e=await r.json();w(e)}}catch(e){console.error("Failed to fetch history",e)}},T=(e,r,a)=>{if(p(e),y(r),j(a),"CHANNEL"===r)v("# ".concat(a.name));else if("GROUP"===r)v(a.name);else{var s,n;let e=null==(n=a.ConversationParticipant)||null==(s=n.find(e=>e.User.id!==(null==t?void 0:t.id)))?void 0:s.User;v((null==e?void 0:e.displayName)||"Chat")}S(!1)},B=async()=>{var e,r;if(!k||"DIRECT"!==b)return;let a=null==(r=k.ConversationParticipant)||null==(e=r.find(e=>e.User.id!==(null==t?void 0:t.id)))?void 0:e.User;if(a&&confirm("Are you sure you want to block ".concat(a.displayName,"?")))try{let e=localStorage.getItem("token");await fetch("".concat("http://localhost:5000","/api/chat/block"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({blockedId:a.id})}),alert("User blocked")}catch(e){console.error("Failed to block user",e)}},P=async()=>{if(g&&confirm("Are you sure you want to delete this chat? This cannot be undone."))try{let e=localStorage.getItem("token");await fetch("".concat("http://localhost:5000","/api/chat/conversation/").concat(g),{method:"DELETE",headers:{Authorization:"Bearer ".concat(e)}}),p(""),y(""),window.location.reload()}catch(e){console.error("Failed to delete chat",e)}},z=async()=>{if(g&&"GROUP"===b&&confirm("Are you sure you want to leave this group?"))try{let e=localStorage.getItem("token");await fetch("".concat("http://localhost:5000","/api/chat/group/leave"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({conversationId:g})}),p(""),y(""),window.location.reload()}catch(e){console.error("Failed to leave group",e)}};return t?(0,a.jsxs)("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900 overflow-hidden",children:[(0,a.jsx)(c,{currentUser:t,currentChannelId:g,onChannelSelect:e=>T(e.id,"CHANNEL",e),onConversationSelect:T,onLogout:()=>{l&&l.disconnect(),localStorage.removeItem("token"),localStorage.removeItem("refreshToken"),localStorage.removeItem("user"),e.push("/login")},isOpen:C,onClose:()=>S(!1)}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col h-full w-full relative",children:[(0,a.jsxs)("div",{className:"h-16 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between px-4 shadow-sm z-10",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("button",{className:"md:hidden mr-4 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",onClick:()=>S(!0),children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),(0,a.jsxs)("div",{className:"flex items-center",children:["CHANNEL"===b&&(0,a.jsx)("span",{className:"text-2xl text-gray-400 mr-2",children:"#"}),(0,a.jsx)("h2",{className:"text-lg font-bold text-gray-800 dark:text-white",children:f||"Select a chat"})]})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full mr-2 ".concat(u?"bg-green-500":"bg-red-500")}),(0,a.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400 hidden sm:inline mr-4",children:u?"Connected":"Disconnected"}),g&&(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("button",{onClick:()=>A(!L),className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-500",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})}),L&&(0,a.jsxs)("div",{className:"absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 py-1 z-50",children:[(0,a.jsx)("button",{onClick:()=>{A(!1),"DIRECT"===b&&M(k)},className:"w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700",children:"View Profile"}),"DIRECT"===b&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>{if(A(!1),k){var e,r;let a=null==(r=k.ConversationParticipant)||null==(e=r.find(e=>e.User.id!==(null==t?void 0:t.id)))?void 0:e.User;if(a&&a.email){let e=localStorage.getItem("token");fetch("".concat("http://localhost:5000","/api/contacts/add"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({email:a.email})}).then(e=>e.json()).then(e=>{e.error?alert(e.error):alert("Contact added successfully")}).catch(e=>console.error(e))}}},className:"w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700",children:"Add to Contacts"}),(0,a.jsx)("button",{onClick:()=>{A(!1),B()},className:"w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-gray-100 dark:hover:bg-gray-700",children:"Block User"})]}),(0,a.jsx)("button",{onClick:()=>{A(!1),P()},className:"w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-gray-100 dark:hover:bg-gray-700",children:"Delete Chat"}),"GROUP"===b&&(0,a.jsx)("button",{onClick:()=>{A(!1),z()},className:"w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-gray-100 dark:hover:bg-gray-700",children:"Leave Group"})]})]})]})]}),g?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x,{messages:N,currentUser:t}),(0,a.jsx)(h,{onSendMessage:e=>{if(!l||!g||!t)return;let r={content:e,senderId:t.id};"CHANNEL"===b?r.channelId=g:r.conversationId=g,l.emit("send_message",r)},disabled:!u})]}):(0,a.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center text-gray-400 p-4 text-center",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 mb-4 opacity-20",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 8h2a2 2 0 012 2v6a2 2 0 01-2 2h-2v4l-4-4H9a1.994 1.994 0 01-1.414-.586m0 0L11 14h4a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2v4l.586-.586z"})}),(0,a.jsx)("p",{className:"text-lg font-medium",children:"Welcome to My SecureChat"}),(0,a.jsx)("p",{className:"text-sm mt-2",children:"Select a contact or group to start chatting."})]})]}),(0,a.jsx)(d,{isOpen:!!U,onClose:()=>M(null),user:U})]}):(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-brand-600"})})}},5802:(e,t,r)=>{Promise.resolve().then(r.bind(r,4224))}},e=>{e.O(0,[976,441,255,358],()=>e(e.s=5802)),_N_E=e.O()}]);