(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[457],{1450:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var a=r(5155),s=r(2115),n=r(63),l=r(9829);function o(e){var t;let{currentUser:r,currentChannelId:n,onChannelSelect:l,onLogout:o,isOpen:d,onClose:i}=e,[c,x]=(0,s.useState)([]);return(0,s.useEffect)(()=>{(async()=>{try{let e=await fetch("".concat("http://localhost:5000","/api/chat/channels"));if(e.ok){let t=await e.json();x(t)}}catch(e){console.error("Failed to fetch channels",e)}})()},[]),(0,a.jsxs)(a.Fragment,{children:[d&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-20 md:hidden",onClick:i}),(0,a.jsxs)("div",{className:"\n                fixed md:static inset-y-0 left-0 z-30 w-64 bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 flex flex-col transform transition-transform duration-200 ease-in-out\n                ".concat(d?"translate-x-0":"-translate-x-full md:translate-x-0","\n            "),children:[(0,a.jsxs)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center",children:[(0,a.jsx)("h1",{className:"text-xl font-bold text-brand-600 dark:text-brand-400",children:"My SecureChat"}),(0,a.jsx)("button",{onClick:i,className:"md:hidden text-gray-500",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4",children:[(0,a.jsx)("h2",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider mb-4",children:"Channels"}),(0,a.jsx)("div",{className:"space-y-2",children:c.map(e=>(0,a.jsxs)("button",{onClick:()=>{l(e),i()},className:"w-full text-left px-3 py-2 rounded-lg font-medium transition ".concat(n===e.id?"bg-brand-50 dark:bg-brand-900/20 text-brand-700 dark:text-brand-300":"text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700/50"),children:["# ",e.name]},e.id))})]}),(0,a.jsx)("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-brand-100 dark:bg-brand-900 flex items-center justify-center text-brand-600 dark:text-brand-300 font-bold",children:null==r||null==(t=r.displayName)?void 0:t.charAt(0).toUpperCase()}),(0,a.jsx)("div",{className:"ml-3",children:(0,a.jsx)("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:null==r?void 0:r.displayName})})]}),(0,a.jsx)("button",{onClick:o,className:"text-gray-400 hover:text-red-500 transition",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})})})]})})]})]})}function d(e){let{messages:t,currentUser:r}=e,n=(0,s.useRef)(null);return(0,s.useEffect)(()=>{var e;null==(e=n.current)||e.scrollIntoView({behavior:"smooth"})},[t]),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50 dark:bg-gray-900",children:[0===t.length?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 mb-4 opacity-20",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),(0,a.jsx)("p",{children:"No messages yet. Start the conversation!"})]}):t.map(e=>{var t;let s=e.senderId===(null==r?void 0:r.id),n=(null==(t=e.User)?void 0:t.displayName)||"Unknown";return(0,a.jsx)("div",{className:"flex ".concat(s?"justify-end":"justify-start"),children:(0,a.jsxs)("div",{className:"max-w-[85%] md:max-w-md lg:max-w-lg xl:max-w-xl rounded-2xl px-4 py-3 shadow-sm ".concat(s?"bg-brand-600 text-white rounded-br-none":"bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200 rounded-bl-none border border-gray-100 dark:border-gray-700"),children:[!s&&(0,a.jsx)("p",{className:"text-xs font-bold text-brand-600 dark:text-brand-400 mb-1",children:n}),(0,a.jsx)("p",{className:"text-sm md:text-base leading-relaxed break-words",children:e.content}),(0,a.jsx)("p",{className:"text-[10px] mt-1 text-right ".concat(s?"text-brand-100":"text-gray-400"),children:new Date(e.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},e.id)}),(0,a.jsx)("div",{ref:n})]})}function i(e){let{onSendMessage:t,disabled:r}=e,[n,l]=(0,s.useState)("");return(0,a.jsx)("div",{className:"p-4 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700",children:(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),n.trim()&&!r&&(t(n),l(""))},className:"flex gap-4 max-w-4xl mx-auto",children:[(0,a.jsx)("input",{type:"text",value:n,onChange:e=>l(e.target.value),placeholder:"Type a message...",className:"flex-1 px-4 py-3 bg-gray-100 dark:bg-gray-700 border-0 rounded-xl focus:ring-2 focus:ring-brand-500 focus:bg-white dark:focus:bg-gray-600 transition dark:text-white",disabled:r}),(0,a.jsxs)("button",{type:"submit",disabled:!n.trim()||r,className:"bg-brand-600 text-white px-6 py-3 rounded-xl hover:bg-brand-700 transition disabled:opacity-50 disabled:cursor-not-allowed font-semibold shadow-lg shadow-brand-600/20 flex items-center gap-2",children:[(0,a.jsx)("span",{className:"hidden sm:inline",children:"Send"}),(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9-2-9-18-9 18 9-2zm0 0v-8"})})]})]})})}function c(){let e=(0,n.useRouter)(),[t,r]=(0,s.useState)(null),[c,x]=(0,s.useState)(null),[h,m]=(0,s.useState)(!1),[g,u]=(0,s.useState)(""),[b,f]=(0,s.useState)(""),[y,j]=(0,s.useState)([]),[v,p]=(0,s.useState)(!1);(0,s.useEffect)(()=>{if(!localStorage.getItem("token"))return void e.push("/login");let t=localStorage.getItem("user");t&&r(JSON.parse(t))},[e]),(0,s.useEffect)(()=>{if(!t)return;let e=localStorage.getItem("token"),r=(0,l.io)("http://localhost:5000",{auth:{token:e}});return r.on("connect",()=>{console.log("Connected to socket server"),m(!0)}),r.on("disconnect",()=>{console.log("Disconnected from socket server"),m(!1)}),r.on("receive_message",e=>{j(t=>e.channelId===g?[...t,e]:t)}),x(r),()=>{r.disconnect()}},[t]),(0,s.useEffect)(()=>{c&&g&&(c.emit("join_channel",g),k(g))},[g,c]);let k=async e=>{try{let t=await fetch("".concat("http://localhost:5000","/api/chat/history/").concat(e));if(t.ok){let e=await t.json();j(e)}}catch(e){console.error("Failed to fetch history",e)}};return t?(0,a.jsxs)("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900 overflow-hidden",children:[(0,a.jsx)(o,{currentUser:t,currentChannelId:g,onChannelSelect:e=>{u(e.id),f(e.name)},onLogout:()=>{c&&c.disconnect(),localStorage.removeItem("token"),localStorage.removeItem("refreshToken"),localStorage.removeItem("user"),e.push("/login")},isOpen:v,onClose:()=>p(!1)}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col h-full w-full relative",children:[(0,a.jsxs)("div",{className:"h-16 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between px-4 shadow-sm z-10",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("button",{className:"md:hidden mr-4 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",onClick:()=>p(!0),children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"text-2xl text-gray-400 mr-2",children:"#"}),(0,a.jsx)("h2",{className:"text-lg font-bold text-gray-800 dark:text-white",children:b||"Select a channel"})]})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full mr-2 ".concat(h?"bg-green-500":"bg-red-500")}),(0,a.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400 hidden sm:inline",children:h?"Connected":"Disconnected"})]})]}),g?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d,{messages:y,currentUser:t}),(0,a.jsx)(i,{onSendMessage:e=>{c&&g&&t&&c.emit("send_message",{channelId:g,content:e,senderId:t.id})},disabled:!h})]}):(0,a.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center text-gray-400 p-4 text-center",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 mb-4 opacity-20",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 8h2a2 2 0 012 2v6a2 2 0 01-2 2h-2v4l-4-4H9a1.994 1.994 0 01-1.414-.586m0 0L11 14h4a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2v4l.586-.586z"})}),(0,a.jsx)("p",{className:"text-lg font-medium",children:"Welcome to My SecureChat"}),(0,a.jsx)("p",{className:"text-sm mt-2",children:"Select a channel from the sidebar to start chatting."})]})]})]}):(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-brand-600"})})}},5802:(e,t,r)=>{Promise.resolve().then(r.bind(r,1450))}},e=>{e.O(0,[976,441,255,358],()=>e(e.s=5802)),_N_E=e.O()}]);